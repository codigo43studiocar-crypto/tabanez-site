import { NextResponse } from "next/server";
import fs from "fs";
import path from "path";

const DATA_PATH = path.join(process.cwd(), "data", "galeria.json");

function load() {
  try {
    if (!fs.existsSync(DATA_PATH)) return [];
    const json = fs.readFileSync(DATA_PATH, "utf8");
    return JSON.parse(json || "[]");
  } catch {
    return [];
  }
}

function save(list) {
  fs.mkdirSync(path.dirname(DATA_PATH), { recursive: true });
  fs.writeFileSync(DATA_PATH, JSON.stringify(list, null, 2));
}

export async function GET() {
  return NextResponse.json({ itens: load() });
}

export async function PUT(req) {
  const body = await req.json();
  if (!Array.isArray(body.itens))
    return NextResponse.json({ error: "Lista inv√°lida" }, { status: 400 });

  save(body.itens);
  return NextResponse.json({ itens: body.itens });
}
